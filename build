#/bin/bash!

#add here the paths to given files and directories.
#bin folder of compiler.
compiler_directory=$(dirname $(dirname $PWD))/compilers/gcc-linaro-7.1.1-2017.08-x86_64_aarch64-elf/bin
#folder containing raspberry pi boot files.
binary_blob_directory=source_code/pi_3/boot/binary_blob
#path of image file.
image_directory=compiled_code/kernel8.img
#path to copy image file to.
sd_directory=/home/tsrapnik/tftp_root/8f3e7b47
#sd_directory=/media/tsrapnik/ODESSA

#if boot option is given, copy all boot files which load the actual image to the sd card.
#if clean option is given, remove the entire compiled_code folder.
#if no option is given, include the compiler path to this shell session. compile the program with make. copy the compiled image
#immediately to an sd card so it is ready for testing.
#todo: make possible to switch between sd card and tftp option.

if [ "$1" = "boot" ]
then
    cp $binary_blob_directory/bootcode.bin /media/tsrapnik/ODESSA
    cp $binary_blob_directory/fixup.dat /media/tsrapnik/ODESSA
    cp $binary_blob_directory/start.elf /media/tsrapnik/ODESSA
    if [ $? -eq 0 ]
    then
        echo "copy boot files to sd card."
    fi
elif [ "$1" = "clean" ]
then
    make clean
else
    export PATH=$PATH:$compiler_directory
    make
    cp $image_directory $sd_directory
    if [ $? -eq 0 ]
    then
        echo "copy image to sd card."
    fi
fi